---
title: "CTD binning"
author: "Marko Lipka"
date: "8/20/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("CTDbinning.R")
```

Functions are defined in **CTDbinning.R**.

Function *binCTD.mean()* applies the *mean()* function to all parameters of a given data frame binned by one of its parameter (usually depth or pressure).

Arguments:

- **.data**: the data.frame to be summarized
- **.binvar**: the variable name to bin over
- **.breaks**: breaks as used by *cut()* (either a single value giving the number of equally distributed bins or a vector of cut points)
- **.binwidth**: alternatively to **.breaks** the binwidth can be set (overwrites **.breaks**)

# Example:

## Raw example data

from a CTD cast in the Arkona Basin (southern Baltic Sea).

```{r}
load("example_ctd") 
ctd <- select(ctd, prDM : par)

knitr::kable(ctd)
```

## Binned:
```{r binned}
binned <- binCTD.mean(.data = ctd,
                      .binvar = "prDM",
                      .binwidth = 1)

knitr::kable(binned)
```

# Plot results (unbinned vs binned):

```{r plot}
binned %>%
    gather(key = "variable", value = "value", -bins, -prDM) %>%
    ggplot() +
    aes(x = prDM, y = value) +
    geom_point(data = gather(ctd, key = "variable", value = "value", -prDM),
               shape = 21) +
    geom_point(color = "red") +
    facet_grid(~variable, scales = "free") +
    coord_flip() +
    scale_x_reverse()
```

