CTD binning
================
Marko Lipka
8/20/2018

Functions are defined in **CTDbinning.R**.

Function *binCTD.mean()* applies the *mean()* function to all parameters of a given data frame binned by one of its parameter (usually depth or pressure).

Arguments:

-   **.data**: the data.frame to be summarized
-   **.binvar**: the variable name to bin over
-   **.breaks**: breaks as used by *cut()* (either a single value giving the number of equally distributed bins or a vector of cut points)
-   **.binwidth**: alternatively to **.breaks** the binwidth can be set (overwrites **.breaks**)

Example:
========

Raw example data
----------------

from a CTD cast in the Arkona Basin (southern Baltic Sea).

``` r
load("example_ctd") 
ctd <- select(ctd, prDM : par)

knitr::kable(ctd)
```

|      prDM|   c0mS.cm|   c1mS.cm|   t090C|   t190C|    sal00|    sal11|  sbeox0ML.L|  sbeox1ML.L|     svCM|  oxsatML.L|      altM|       par|
|---------:|---------:|---------:|-------:|-------:|--------:|--------:|-----------:|-----------:|--------:|----------:|---------:|---------:|
|   1.36001|  14.16115|  14.16036|  6.1272|  6.1251|  13.2087|  13.2088|     8.65394|     8.74601|  1447.91|    7.95670|  17.55465|  402.8700|
|   1.61264|  14.16280|  14.16364|  6.1245|  6.1219|  13.2115|  13.2133|     8.65493|     8.72731|  1447.90|    7.95708|  16.83636|  386.3400|
|   1.86478|  14.16379|  14.16305|  6.1236|  6.1211|  13.2128|  13.2130|     8.65435|     8.73503|  1447.91|    7.95719|  16.97811|  365.7800|
|   2.11683|  14.16334|  14.16383|  6.1227|  6.1207|  13.2126|  13.2138|     8.65487|     8.74630|  1447.91|    7.95737|  16.75866|  336.8300|
|   2.36962|  14.16532|  14.16366|  6.1229|  6.1206|  13.2145|  13.2137|     8.65615|     8.72256|  1447.91|    7.95724|  16.53253|  306.9200|
|   2.62119|  14.16302|  14.16275|  6.1224|  6.1208|  13.2122|  13.2126|     8.65235|     8.73113|  1447.91|    7.95746|  16.25545|  282.5500|
|   2.87361|  14.16270|  14.16321|  6.1225|  6.1199|  13.2118|  13.2134|     8.66118|     8.73442|  1447.92|    7.95746|  15.94486|  260.4100|
|   3.12572|  14.16310|  14.16297|  6.1215|  6.1194|  13.2126|  13.2133|     8.65893|     8.73448|  1447.92|    7.95761|  15.75344|  240.8900|
|   3.37831|  14.16301|  14.16445|  6.1210|  6.1178|  13.2127|  13.2154|     8.65753|     8.73657|  1447.92|    7.95771|  15.56046|  217.5000|
|   3.63016|  14.16485|  14.16545|  6.1188|  6.1166|  13.2154|  13.2168|     8.66033|     8.73692|  1447.92|    7.95800|  14.83946|  209.8400|
|   3.88273|  14.16518|  14.17255|  6.1185|  6.1095|  13.2156|  13.2269|     8.66183|     8.74779|  1447.92|    7.95803|  14.81576|  196.7800|
|   4.13487|  14.16931|  14.17895|  6.1143|  6.1030|  13.2221|  13.2360|     8.66311|     8.74706|  1447.91|    7.95858|  14.68473|  169.2600|
|   4.38717|  14.16919|  14.17440|  6.1140|  6.1065|  13.2215|  13.2297|     8.66173|     8.73560|  1447.92|    7.95861|  14.43718|  159.5600|
|   4.63930|  14.18452|  14.17993|  6.0950|  6.0988|  13.2451|  13.2386|     8.66165|     8.74519|  1447.87|    7.96120|  14.18563|  147.8100|
|   4.89165|  14.17770|  14.18080|  6.1028|  6.0955|  13.2345|  13.2402|     8.66120|     8.75530|  1447.89|    7.96013|  13.94903|  136.2300|
|   5.14395|  14.17406|  14.17383|  6.1061|  6.1059|  13.2294|  13.2291|     8.66374|     8.75167|  1447.90|    7.95977|  13.69822|  125.3100|
|   5.39597|  14.17083|  14.17188|  6.1131|  6.1104|  13.2231|  13.2252|     8.66258|     8.74922|  1447.93|    7.95872|  13.43070|  115.3000|
|   5.64864|  14.18255|  14.18024|  6.1023|  6.1016|  13.2394|  13.2373|     8.65772|     8.73006|  1447.91|    7.95998|  13.18286|  107.0100|
|   5.90063|  14.18828|  14.17989|  6.1012|  6.1016|  13.2456|  13.2368|     8.65953|     8.71610|  1447.92|    7.95987|  12.90581|   99.4450|
|   6.15294|  14.25398|  14.23611|  6.1008|  6.0983|  13.3130|  13.2950|     8.68627|     8.74802|  1448.00|    7.95644|  12.67231|   92.6420|
|   6.40502|  14.31108|  14.32640|  6.1079|  6.1085|  13.3663|  13.3820|     8.69804|     8.76309|  1448.10|    7.95230|  12.42511|   85.2070|
|   6.65751|  14.40616|  14.40764|  6.1019|  6.0986|  13.4657|  13.4685|     8.68989|     8.77727|  1448.21|    7.94831|  12.11428|   80.7850|
|   6.90966|  14.42686|  14.42802|  6.0541|  6.0500|  13.5067|  13.5097|     8.69039|     8.76569|  1448.06|    7.95553|  11.86291|   75.1250|
|   7.16208|  14.42822|  14.42770|  6.0259|  6.0230|  13.5198|  13.5205|     8.69254|     8.76656|  1447.97|    7.96039|  11.60969|   69.6820|
|   7.41397|  14.42954|  14.43186|  6.0144|  6.0152|  13.5256|  13.5275|     8.69461|     8.77146|  1447.93|    7.96235|  11.37238|   64.4640|
|   7.66669|  14.43783|  14.43694|  6.0127|  6.0082|  13.5344|  13.5354|     8.69191|     8.75220|  1447.94|    7.96222|  11.10942|   60.3930|
|   7.91862|  14.43107|  14.42979|  5.9924|  5.9869|  13.5359|  13.5368|     8.67903|     8.75513|  1447.86|    7.96613|  10.83857|   56.3030|
|   8.17115|  14.42719|  14.42947|  5.9716|  5.9735|  13.5404|  13.5418|     8.68420|     8.74503|  1447.78|    7.96999|  10.57913|   52.2490|
|   8.42334|  14.43372|  14.43183|  5.9694|  5.9629|  13.5476|  13.5484|     8.67459|     8.73869|  1447.78|    7.97006|  10.27849|   48.8650|
|   8.67537|  14.42534|  14.42704|  5.9341|  5.9339|  13.5537|  13.5554|     8.68044|     8.74850|  1447.64|    7.97670|  10.02631|   45.7340|
|   8.92763|  14.43384|  14.43374|  5.9350|  5.9310|  13.5616|  13.5631|     8.66313|     8.73806|  1447.66|    7.97609|   9.79494|   42.5310|
|   9.18019|  14.43299|  14.43210|  5.9024|  5.8965|  13.5742|  13.5758|     8.65143|     8.72628|  1447.54|    7.98187|   9.52281|   39.3260|
|   9.43236|  14.42492|  14.42566|  5.8595|  5.8568|  13.5838|  13.5856|     8.63803|     8.71539|  1447.38|    7.98985|   9.26731|   36.6010|
|   9.68471|  14.43835|  14.43938|  5.8398|  5.8367|  13.6054|  13.6077|     8.63520|     8.71414|  1447.33|    7.99262|   9.01486|   33.8560|
|   9.93666|  14.46043|  14.46190|  5.8375|  5.8369|  13.6284|  13.6300|     8.62931|     8.70148|  1447.35|    7.99189|   8.75897|   31.3660|
|  10.18954|  14.47104|  14.47204|  5.8384|  5.8367|  13.6382|  13.6400|     8.62710|     8.69544|  1447.37|    7.99117|   8.48738|   28.9700|
|  10.44156|  14.48015|  14.48132|  5.8288|  5.8267|  13.6513|  13.6533|     8.62321|     8.68568|  1447.35|    7.99240|   8.20142|   26.7280|
|  10.69364|  14.49231|  14.49405|  5.8152|  5.8127|  13.6692|  13.6720|     8.61660|     8.66523|  1447.32|    7.99415|   7.95248|   24.6780|
|  10.94627|  14.51737|  14.51855|  5.7996|  5.7976|  13.7011|  13.7031|     8.60120|     8.66816|  1447.30|    7.99557|   7.70210|   22.8360|
|  11.19851|  14.54466|  14.54917|  5.7844|  5.7815|  13.7352|  13.7410|     8.58937|     8.66109|  1447.28|    7.99680|   7.43637|   21.0360|
|  11.45074|  14.60579|  14.60996|  5.7588|  5.7562|  13.8085|  13.8138|     8.57875|     8.65774|  1447.27|    7.99802|   7.13987|   19.3410|
|  11.70296|  14.63902|  14.64220|  5.7549|  5.7534|  13.8438|  13.8476|     8.56933|     8.63562|  1447.30|    7.99695|   6.89543|   17.8840|
|  11.95537|  14.66024|  14.66036|  5.7546|  5.7531|  13.8652|  13.8659|     8.59165|     8.65291|  1447.33|    7.99590|   6.62272|   16.5570|
|  12.20750|  14.67749|  14.67857|  5.7541|  5.7526|  13.8829|  13.8845|     8.59355|     8.67703|  1447.35|    7.99506|   6.38295|   15.2590|
|  12.45972|  14.70314|  14.70147|  5.7518|  5.7507|  13.9098|  13.9085|     8.60480|     8.67407|  1447.38|    7.99410|   6.14061|   14.1030|
|  12.71220|  14.72033|  14.72269|  5.7500|  5.7483|  13.9280|  13.9310|     8.58516|     8.66514|  1447.40|    7.99351|   5.87805|   13.0990|
|  12.96460|  14.75906|  14.75990|  5.7462|  5.7443|  13.9690|  13.9708|     8.54859|     8.62383|  1447.44|    7.99211|   5.59697|   12.1810|
|  13.21683|  14.79390|  14.79253|  5.7345|  5.7337|  14.0098|  14.0087|     8.49366|     8.57247|  1447.45|    7.99229|   5.29826|   11.2850|
|  13.46876|  14.80368|  14.80367|  5.7330|  5.7316|  14.0203|  14.0208|     8.50380|     8.56387|  1447.46|    7.99207|   4.99694|   10.4550|
|  13.72097|  14.82069|  14.82268|  5.7335|  5.7315|  14.0373|  14.0402|     8.51706|     8.56589|  1447.48|    7.99105|   4.78944|    9.7649|
|  13.97349|  14.84423|  14.84825|  5.7265|  5.7247|  14.0644|  14.0693|     8.49982|     8.55786|  1447.49|    7.99103|   4.53706|    9.1644|
|  14.22582|  14.89464|  14.90094|  5.7187|  5.7151|  14.1195|  14.1275|     8.51253|     8.55551|  1447.53|    7.98970|   4.27003|    8.5750|
|  14.47779|  14.97532|  14.97923|  5.7164|  5.7152|  14.2032|  14.2077|     8.51167|     8.59136|  1447.63|    7.98575|   4.01070|    8.0462|
|  14.73010|  15.12716|  15.12750|  5.7231|  5.7217|  14.3566|  14.3572|     8.53294|     8.60995|  1447.86|    7.97640|   3.75988|    7.5571|
|  14.98250|  15.30768|  15.31647|  5.7129|  5.7092|  14.5467|  14.5575|     8.46200|     8.52119|  1448.06|    7.96849|   3.49701|    7.0785|
|  15.23485|  15.41775|  15.41984|  5.5992|  5.5926|  14.7128|  14.7179|     8.36645|     8.42073|  1447.79|    7.98230|   3.24270|    6.5971|
|  15.48713|  15.50809|  15.52434|  5.4689|  5.4619|  14.8667|  14.8867|     8.32254|     8.36966|  1447.43|    8.00009|   2.99729|    6.1493|
|  15.73911|  15.68814|  15.69650|  5.3841|  5.3815|  15.0929|  15.1029|     8.29023|     8.33327|  1447.36|    8.00509|   2.73771|    5.7247|
|  15.99135|  15.73768|  15.73929|  5.3723|  5.3681|  15.1490|  15.1527|     8.24383|     8.29418|  1447.39|    8.00448|   2.48601|    5.3485|
|  16.24375|  15.77115|  15.78238|  5.3251|  5.3206|  15.2065|  15.2193|     8.17846|     8.22329|  1447.26|    8.01088|   2.20397|    4.9582|
|  16.49580|  16.07121|  16.09350|  5.2214|  5.2134|  15.5688|  15.5970|     8.08890|     8.13299|  1447.28|    8.01248|   1.93661|    4.5679|
|  16.74801|  16.47295|  16.50643|  5.1378|  5.1320|  16.0333|  16.0715|     7.99736|     8.04068|  1447.52|    8.00472|   1.67326|    4.2285|
|  17.00029|  16.61826|  16.62354|  5.1183|  5.1167|  16.1952|  16.2015|     7.94006|     7.99494|  1447.64|    8.00010|   1.42746|    3.9255|
|  17.25263|  16.64181|  16.64214|  5.1145|  5.1135|  16.2207|  16.2215|     7.93073|     7.99170|  1447.66|    7.99953|   1.14989|    3.6354|
|  17.50504|  16.65272|  16.65273|  5.1156|  5.1134|  16.2256|  16.2267|     7.94661|     8.00465|  1447.68|    7.99904|   3.57480|    3.2456|

Binned:
-------

``` r
binned <- binCTD.mean(.data = ctd,
                      .binvar = "prDM",
                      .binwidth = 1)

knitr::kable(binned)
```

| bins     |       prDM|   c0mS.cm|   c1mS.cm|     t090C|     t190C|     sal00|     sal11|  sbeox0ML.L|  sbeox1ML.L|      svCM|  oxsatML.L|       altM|         par|
|:---------|----------:|---------:|---------:|---------:|---------:|---------:|---------:|-----------:|-----------:|---------:|----------:|----------:|-----------:|
| (1,2\]   |   1.612477|  14.16258|  14.16235|  6.125100|  6.122700|  13.21100|  13.21170|    8.654407|    8.736117|  1447.907|   7.956990|  17.123040|  384.996667|
| (2,3\]   |   2.495312|  14.16360|  14.16336|  6.122625|  6.120500|  13.21278|  13.21337|    8.656137|    8.733602|  1447.912|   7.957382|  16.372875|  296.677500|
| (3,4\]   |   3.504230|  14.16404|  14.16635|  6.119950|  6.115825|  13.21407|  13.21810|    8.659655|    8.738940|  1447.920|   7.957838|  15.242280|  216.252500|
| (4,5\]   |   4.513248|  14.17518|  14.17852|  6.106525|  6.100950|  13.23080|  13.23612|    8.661922|    8.745788|  1447.898|   7.959630|  14.314143|  153.215000|
| (5,6\]   |   5.522297|  14.17893|  14.17646|  6.105675|  6.104875|  13.23438|  13.23210|    8.660892|    8.736762|  1447.915|   7.959585|  13.304398|  111.766250|
| (6,7\]   |   6.531282|  14.34952|  14.34954|  6.091175|  6.088850|  13.41292|  13.41380|    8.691147|    8.763518|  1448.092|   7.953145|  12.268652|   83.439750|
| (7,8\]   |   7.540340|  14.43166|  14.43157|  6.011350|  6.008325|  13.52892|  13.53005|    8.689523|    8.761337|  1447.925|   7.962772|  11.232515|   62.710500|
| (8,9\]   |   8.549373|  14.43002|  14.43052|  5.952525|  5.950325|  13.55082|  13.55218|    8.675590|    8.742570|  1447.715|   7.973210|  10.169718|   47.344750|
| (9,10\]  |   9.558480|  14.43917|  14.43976|  5.859800|  5.856725|  13.59795|  13.59977|    8.638492|    8.714322|  1447.400|   7.989058|   9.140987|   35.287250|
| (10,11\] |  10.567752|  14.49022|  14.49149|  5.820500|  5.818425|  13.66495|  13.66710|    8.617028|    8.678627|  1447.335|   7.993322|   8.085845|   25.803000|
| (11,12\] |  11.576895|  14.61243|  14.61542|  5.763175|  5.761050|  13.81317|  13.81708|    8.582275|    8.651840|  1447.295|   7.996918|   7.023598|   18.704500|
| (12,13\] |  12.586005|  14.71500|  14.71566|  5.750525|  5.748975|  13.92243|  13.92370|    8.583025|    8.660018|  1447.392|   7.993695|   5.999645|   13.660500|
| (13,14\] |  13.595012|  14.81562|  14.81678|  5.731875|  5.730375|  14.03295|  14.03475|    8.503585|    8.565022|  1447.470|   7.991610|   4.905425|   10.167325|
| (14,15\] |  14.604052|  15.07620|  15.08104|  5.717775|  5.715300|  14.30650|  14.31247|    8.504785|    8.569503|  1447.770|   7.980085|   3.884405|    7.814200|
| (15,16\] |  15.613110|  15.58791|  15.59499|  5.456125|  5.451025|  14.95535|  14.96505|    8.305763|    8.354460|  1447.493|   7.997990|   2.865928|    5.954900|
| (16,17\] |  16.495853|  16.10510|  16.12743|  5.228100|  5.222000|  15.60287|  15.62927|    8.088240|    8.132320|  1447.353|   8.009360|   1.937947|    4.584867|
| (17,18\] |  17.252653|  16.63759|  16.63947|  5.116133|  5.114533|  16.21383|  16.21657|    7.939133|    7.997097|  1447.660|   7.999557|   2.050717|    3.602167|

Plot results (unbinned vs binned):
==================================

``` r
binned %>%
    gather(key = "variable", value = "value", -bins, -prDM) %>%
    ggplot() +
    aes(x = prDM, y = value) +
    geom_point(data = gather(ctd, key = "variable", value = "value", -prDM),
               shape = 21) +
    geom_point(color = "red") +
    facet_grid(~variable, scales = "free") +
    coord_flip() +
    scale_x_reverse()
```

![](README_files/figure-markdown_github/plot-1.png)
